<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>IPTV节目列表正则处理工具</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1200px; margin: 20px auto; padding: 0 20px; }
        .container { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; }
        textarea { width: 100%; height: 200px; padding: 10px; border: 1px solid #ddd; border-radius: 4px; resize: vertical; }
        input { padding: 8px 12px; margin-right: 10px; border: 1px solid #ddd; border-radius: 4px; }
        button { padding: 8px 16px; background: #007bff; color: #fff; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>IPTV节目列表 → M3U格式转换</h1>

    <!-- 1. 输入区：原始节目列表 -->
    <div class="container">
        <label for="sourceText">1. 粘贴原始IPTV节目列表：</label>
        <textarea id="sourceText" placeholder="例如：xxxChannelName=&quot;CCTV1&quot;,UserChannelID=&quot;1001&quot;,ChannelURL=&quot;udp://239.1.1.1:1234&quot;.timexxx"></textarea>
    </div>

    <!-- 2. 代理地址设置 -->
    <div class="container">
        <label for="proxyAddr">2. 输入你的udpxy代理地址（格式：IP:端口）：</label>
        <input type="text" id="proxyAddr" value="0.0.0.0:0000" placeholder="如 192.168.1.100:4022">
    </div>

    <!-- 3. 操作按钮 -->
    <div class="container">
        <button onclick="processIPTV()">执行转换</button>
        <button onclick="copyResult()">复制结果</button>
        <button onclick="clearAll()">清空内容</button>
    </div>

    <!-- 4. 输出区：处理后的M3U内容 -->
    <div class="container">
        <label for="resultText">3. 处理后的M3U列表（可直接保存为 .m3u 文件）：</label>
        <textarea id="resultText" readonly placeholder="转换后的内容将显示在这里..."></textarea>
    </div>

    <script>
        // 核心处理函数
        function processIPTV() {
            // 获取输入内容和代理地址
            const source = document.getElementById('sourceText').value;
            const proxy = document.getElementById('proxyAddr').value.trim();
            if (!source) { alert('请先粘贴原始节目列表！'); return; }
            if (!proxy.match(/^\d+\.\d+\.\d+\.\d+:\d+$/)) { alert('代理地址格式错误（需为 IP:端口，如 192.168.1.1:4022）！'); return; }

            // 目标正则表达式（与需求一致）
            const reg = /^.*ChannelNa\+?me="(.+?)",UserChannelID="(.+?)",ChannelURL="(.+?)://(.+)".time.*$/gm;
            // 替换模板（嵌入自定义代理地址）
            const replacement = `#EXTINF:-1,$1\nhttp://${proxy}/udp/$4`;

            // 执行匹配替换，生成M3U内容（添加M3U文件头）
            const result = `#EXTM3U\n${source.replace(reg, replacement)}`;
            document.getElementById('resultText').value = result;
        }

        // 复制结果到剪贴板
        function copyResult() {
            const result = document.getElementById('resultText');
            if (!result.value) { alert('暂无转换结果可复制！'); return; }
            result.select();
            document.execCommand('copy');
            alert('结果已复制到剪贴板，可直接粘贴到文本文件并保存为 .m3u 格式！');
        }

        // 清空所有内容
        function clearAll() {
            document.getElementById('sourceText').value = '';
            document.getElementById('resultText').value = '';
        }
    </script>
</body>
</html>
